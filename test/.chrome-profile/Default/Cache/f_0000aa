System.register("src/Iterable", [], function() {
  "use strict";
  var __moduleName = "src/Iterable";
  function Iterable(last, generatorFunction) {
    var hasLast = arguments.length >= 2;
    generatorFunction = hasLast ? generatorFunction : last;
    last = hasLast ? last : null;
    this['@@iterator'] = generatorFunction;
    this._last = last;
    this._events = {};
  }
  Iterable.prototype.emit = function(event) {
    if (this._last) {
      this._last.emit(event);
    }
    var events = this._events[event] || [];
    for (var i = 0,
        l = events.length; i < l; i++) {
      if (typeof events[i] === 'function')
        events[i].call(this);
    }
    return this;
  };
  Iterable.prototype.on = function(event, handler) {
    if (!Array.isArray(this._events[event])) {
      this._events[event] = [];
    }
    this._events[event].push(handler);
    return this;
  };
  Iterable.prototype.off = function(event, handler) {
    var events = this._events[event] || [];
    var position = events.indexOf(handler);
    if (position !== -1) {
      events[position] = null;
    }
    return this;
  };
  Iterable.prototype.once = function(event, handler) {
    this.on(event, function temp() {
      handler.call(this);
      this.off(event, temp);
    });
    return this;
  };
  Iterable.prototype.map = function(projection) {
    return new Iterable(this, function() {
      var $__0,
          $__1,
          x;
      return $traceurRuntime.generatorWrap(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $__0 = this._last[Symbol.iterator]();
              $ctx.state = 4;
              break;
            case 4:
              $ctx.state = (!($__1 = $__0.next()).done) ? 5 : -2;
              break;
            case 5:
              x = $__1.value;
              $ctx.state = 6;
              break;
            case 6:
              $ctx.state = 2;
              return projection(x);
            case 2:
              $ctx.maybeThrow();
              $ctx.state = 4;
              break;
            default:
              return $ctx.end();
          }
      }, this);
    });
  };
  Iterable.prototype.takeWhile = function(predicate) {
    return new Iterable(this, function() {
      var $__0,
          $__1,
          x;
      return $traceurRuntime.generatorWrap(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              $__0 = this._last[Symbol.iterator]();
              $ctx.state = 9;
              break;
            case 9:
              $ctx.state = (!($__1 = $__0.next()).done) ? 10 : -2;
              break;
            case 10:
              x = $__1.value;
              $ctx.state = 11;
              break;
            case 11:
              $ctx.state = (!predicate(x)) ? 3 : 2;
              break;
            case 3:
              this.emit('close');
              $ctx.state = -2;
              break;
            case 2:
              $ctx.state = 7;
              return x;
            case 7:
              $ctx.maybeThrow();
              $ctx.state = 9;
              break;
            default:
              return $ctx.end();
          }
      }, this);
    });
  };
  function SyncReader() {
    this.current = -1;
    this.items = [1, 2, 3, 4, 5];
  }
  SyncReader.prototype.readLine = function() {
    this.current += 1;
    return this.items[this.current];
  };
  SyncReader.prototype.eof = function() {
    return this.current === this.items.length - 1;
  };
  SyncReader.prototype.close = function() {
    this.current = -1;
    this.items = [];
    console.log('closed');
  };
  var reader;
  function getLines(fileName) {
    reader = new SyncReader(fileName);
    return new Iterable(function() {
      return $traceurRuntime.generatorWrap(function($ctx) {
        while (true)
          switch ($ctx.state) {
            case 0:
              this.once('close', SyncReader.prototype.close.bind(reader));
              $ctx.state = 15;
              break;
            case 15:
              $ctx.pushTry(null, 7);
              $ctx.state = 9;
              break;
            case 9:
              if (!reader.eof()) {
                $ctx.state = 1;
                break;
              } else {
                $ctx.state = 7;
                $ctx.finallyFallThrough = -2;
                break;
              }
            case 1:
              $ctx.state = 2;
              return reader.readLine();
            case 2:
              $ctx.maybeThrow();
              $ctx.state = 9;
              break;
            case 7:
              $ctx.popTry();
              $ctx.state = 13;
              break;
            case 13:
              reader.close();
              $ctx.state = 11;
              break;
            case 11:
              $ctx.state = $ctx.finallyFallThrough;
              break;
            default:
              return $ctx.end();
          }
      }, this);
    });
  }
  ;
  var hum = getLines().once('close', (function() {
    return console.log('lkj');
  })).map((function(n) {
    return n * 2;
  })).takeWhile((function(n) {
    return n <= 8;
  }));
  return {};
});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvbGludXNlci9Xb3Jrc3BhY2UvaXRlci9zcmMvSXRlcmFibGUuanMiLCJzb3VyY2VzIjpbIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8zIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzIiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMSIsIi9ob21lL2xpbnVzZXIvV29ya3NwYWNlL2l0ZXIvc3JjL0l0ZXJhYmxlLmpzIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzExIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzUiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMTAiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNCIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci83IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzgiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci85IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzEyIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzE0IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzEzIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzE1IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzAiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxTQUFTLGdCQUFvQixHQUFFLENDQXJDLFVBQVM7O0FDQUwsQ0FBSixJQUFJLENBQUEsWUFBWSxpQkFBb0IsQ0FBQztDQ0FyQyxTQUFTLFNBQVEsQ0FBQyxJQUFJLENBQUUsQ0FBQSxpQkFBaUIsQ0FBRTtBQUNyQyxDQUFKLE1B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a0IsQ0FBQzs7OztrQlQySGxCLENBQUMsTUFBTSxJQUFJLEVBQUU7Ozs7O0FVN0gxQixDQUFBLG1CQUFJLG1CQUFtQixLQUFvQixDQUFBOzs7OztDSkEzQyxtQk44SGMsQ0FBQSxNQUFNLFNBQVMsRUFBRSxDTTlIUDs7QUNBeEIsQ0FBQSxpQkFBSSxXQUFXLEVBQUUsQ0FBQTs7OztBSUFqQixDQUFBLGlCQUFJLE9BQU8sRUFBRSxDQUFDOzs7O0FYa0lSLENBQUEsbUJBQU0sTUFBTSxFQUFFLENBQUM7Ozs7QVlqSUMsQ0FBQSxpQkFBSSxNQUFNLEVBQUcsQ0FBQSxJQUFJLG1CQUFtQixDQUFDO0NBQ3JDLG1CQUFNOztDSkY1QixtQkFBTyxDQUFBLElBQUksSUFBSSxFQUFFLENBQUE7O0NMQ21CLE1BQy9CLENGQU8sS0FBSSxDQUFDLENBQUM7TURrSWQsQ0FBQTtHQUNIO0NBQUEsRUFBQztBQUVFLENBQUosSUFBSSxDQUFBLEdBQUcsRUFBRyxDQUFBLFFBQVEsRUFBRSxLQUNiLENBQUMsT0FBTztVQUFRLENBQUEsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0tBQUMsSUFDcEMsV0FBQyxDQUFDO1VBQUksQ0FBQSxDQUFDLEVBQUcsRUFBQztLQUFDLFVBQ04sV0FBQyxDQUFDO1VBQUksQ0FBQSxDQUFDLEdBQUksRUFBQztLQUFDLENBQUM7Q2ExSTFCLFdBQXdCO0NmRW5CLENERm9ELENBQUM7Q0dpSjFEIiwic291cmNlc0NvbnRlbnQiOlsiU3lzdGVtLnJlZ2lzdGVyKCRfX3BsYWNlaG9sZGVyX18wLCBbXSwgJF9fcGxhY2Vob2xkZXJfXzEpOyIsImZ1bmN0aW9uKCkge1xuICAgICAgJF9fcGxhY2Vob2xkZXJfXzBcbiAgICB9IiwidmFyIF9fbW9kdWxlTmFtZSA9ICRfX3BsYWNlaG9sZGVyX18wOyIsImZ1bmN0aW9uIEl0ZXJhYmxlKGxhc3QsIGdlbmVyYXRvckZ1bmN0aW9uKSB7XG4gIHZhciBoYXNMYXN0ID0gYXJndW1lbnRzLmxlbmd0aCA+PSAyO1xuXG4gIGdlbmVyYXRvckZ1bmN0aW9uID0gaGFzTGFzdCA/IGdlbmVyYXRvckZ1bmN0aW9uIDogbGFzdDtcbiAgbGFzdCA9IGhhc0xhc3QgPyBsYXN0IDogbnVsbDtcbiAgXG4gIHRoaXNbJ0BAaXRlcmF0b3InXSA9IGdlbmVyYXRvckZ1bmN0aW9uO1xuICB0aGlzLl9sYXN0ID0gbGFzdDtcbiAgdGhpcy5fZXZlbnRzID0ge307XG59XG5cbkl0ZXJhYmxlLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKHRoaXMuX2xhc3QpIHtcbiAgICB0aGlzLl9sYXN0LmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50c1tldmVudF0gfHwgW107XG5cbiAgZm9yICh2YXIgaSA9IDAsIGwgPSBldmVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgaWYgKHR5cGVvZiBldmVudHNbaV0gPT09ICdmdW5jdGlvbicpIGV2ZW50c1tpXS5jYWxsKHRoaXMpO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5JdGVyYWJsZS5wcm90b3R5cGUub24gPSBmdW5jdGlvbihldmVudCwgaGFuZGxlcikge1xuICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5fZXZlbnRzW2V2ZW50XSkpIHtcbiAgICB0aGlzLl9ldmVudHNbZXZlbnRdID0gW107XG4gIH1cbiAgdGhpcy5fZXZlbnRzW2V2ZW50XS5wdXNoKGhhbmRsZXIpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuSXRlcmFibGUucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKGV2ZW50LCBoYW5kbGVyKSB7XG4gIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbZXZlbnRdIHx8IFtdO1xuICB2YXIgcG9zaXRpb24gPSBldmVudHMuaW5kZXhPZihoYW5kbGVyKTtcblxuICBpZiAocG9zaXRpb24gIT09IC0xKSB7XG4gICAgZXZlbnRzW3Bvc2l0aW9uXSA9IG51bGw7XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbkl0ZXJhYmxlLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24oZXZlbnQsIGhhbmRsZXIpIHtcbiAgdGhpcy5vbihldmVudCwgZnVuY3Rpb24gdGVtcCgpIHtcbiAgICBoYW5kbGVyLmNhbGwodGhpcyk7XG4gICAgdGhpcy5vZmYoZXZlbnQsIHRlbXApO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbkl0ZXJhYmxlLnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbihwcm9qZWN0aW9uKSB7IFxuICByZXR1cm4gbmV3IEl0ZXJhYmxlKHRoaXMsIGZ1bmN0aW9uKigpIHsgXG4gICAgZm9yICh2YXIgeCBvZiB0aGlzLl9sYXN0KSB7IFxuICAgICAgeWllbGQgcHJvamVjdGlvbih4KTsgXG4gICAgfSBcbiAgfSk7IFxufTtcblxuSXRlcmFibGUucHJvdG90eXBlLnRha2VXaGlsZSA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkgeyBcbi8qXG4gIHJldHVybiBuZXcgSXRlcmFibGUodGhpcywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxhc3QgPSB0aGlzLl9sYXN0WydAQGl0ZXJhdG9yJ10oKTtcblxuICAgIHJldHVybiB7XG4gICAgICBuZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbCA9IGxhc3QubmV4dCgpO1xuXG4gICAgICAgIGlmICh2YWwuZG9uZSB8fCAhcHJlZGljYXRlKHZhbC52YWx1ZSkpIHtcbiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgfVxuICAgIH07XG4gIH0pO1xuICAqL1xuICByZXR1cm4gbmV3IEl0ZXJhYmxlKHRoaXMsIGZ1bmN0aW9uKigpIHsgXG4gICAgZm9yICh2YXIgeCBvZiB0aGlzLl9sYXN0KSB7IFxuICAgICAgaWYgKCFwcmVkaWNhdGUoeCkpIHsgXG4gICAgICAgIHRoaXMuZW1pdCgnY2xvc2UnKTtcbiAgICAgICAgYnJlYWs7IFxuICAgICAgfSBcbiAgICAgIHlpZWxkIHg7IFxuICAgIH0gXG4gIH0pOyBcbn1cblxuZnVuY3Rpb24gU3luY1JlYWRlcigpIHtcbiAgdGhpcy5jdXJyZW50ID0gLTE7XG4gIHRoaXMuaXRlbXMgPSBbXG4gICAgMSwgMiwgMywgNCwgNVxuICBdO1xufVxuXG5TeW5jUmVhZGVyLnByb3RvdHlwZS5yZWFkTGluZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmN1cnJlbnQgKz0gMTtcbiAgcmV0dXJuIHRoaXMuaXRlbXNbdGhpcy5jdXJyZW50XTtcbn07XG5cblN5bmNSZWFkZXIucHJvdG90eXBlLmVvZiA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5jdXJyZW50ID09PSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7XG59O1xuXG5TeW5jUmVhZGVyLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmN1cnJlbnQgPSAtMTtcbiAgdGhpcy5pdGVtcyA9IFtdO1xuXG4gIGNvbnNvbGUubG9nKCdjbG9zZWQnKTtcbn07XG5cbnZhciByZWFkZXI7XG5cbmZ1bmN0aW9uIGdldExpbmVzKGZpbGVOYW1lKSB7XG4gIHJlYWRlciA9IG5ldyBTeW5jUmVhZGVyKGZpbGVOYW1lKTtcblxuICByZXR1cm4gbmV3IEl0ZXJhYmxlKGZ1bmN0aW9uKigpIHtcbiAgICB0aGlzLm9uY2UoJ2Nsb3NlJywgU3luY1JlYWRlci5wcm90b3R5cGUuY2xvc2UuYmluZChyZWFkZXIpKTtcbiAgICBcbiAgICAvL3ZhciByZWFkZXIgPSBuZXcgU3luY1JlYWRlcjtcblxuICAgIHRyeSB7XG4gICAgICB3aGlsZSAoIXJlYWRlci5lb2YoKSkge1xuICAgICAgICB5aWVsZCByZWFkZXIucmVhZExpbmUoKTsgXG4gICAgICB9XG4gICAgfVxuICAgIGZpbmFsbHkge1xuICAgICAgcmVhZGVyLmNsb3NlKCk7XG4gICAgfVxuICB9KVxufTtcblxudmFyIGh1bSA9IGdldExpbmVzKClcbiAgLm9uY2UoJ2Nsb3NlJywgKCkgPT4gY29uc29sZS5sb2coJ2xraicpKVxuICAubWFwKG4gPT4gbiAqIDIpXG4gIC50YWtlV2hpbGUobiA9PiBuIDw9IDgpO1xuXG4vL2ZvciAodmFyIGkgb2YgaHVtKSBjb25zb2xlLmxvZyhpKTtcbi8vZm9yICh2YXIgaSBvZiBodW0pIGNvbnNvbGUubG9nKGkpO1xuLy9odW0uZW1pdCgnY2xvc2UnKTtcblxuLy9mb3IgKHZhciBpIG9mIGh1bS50YWtlV2hpbGUobiA9PiBuIDw9IDEwKSkgY29uc29sZS5sb2coaSk7XG4iLCJyZXR1cm4gJF9fcGxhY2Vob2xkZXJfXzAoXG4gICAgICAgICAgICAkX19wbGFjZWhvbGRlcl9fMSxcbiAgICAgICAgICAgIHRoaXMpOyIsIiR0cmFjZXVyUnVudGltZS5nZW5lcmF0b3JXcmFwIiwiZnVuY3Rpb24oJGN0eCkge1xuICAgICAgd2hpbGUgKHRydWUpICRfX3BsYWNlaG9sZGVyX18wXG4gICAgfSIsIlxuICAgICAgICBmb3IgKHZhciAkX19wbGFjZWhvbGRlcl9fMCA9XG4gICAgICAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18xW1N5bWJvbC5pdGVyYXRvcl0oKSxcbiAgICAgICAgICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzI7XG4gICAgICAgICAgICAgISgkX19wbGFjZWhvbGRlcl9fMyA9ICRfX3BsYWNlaG9sZGVyX180Lm5leHQoKSkuZG9uZTsgKSB7XG4gICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzU7XG4gICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzY7XG4gICAgICAgIH0iLCIkY3R4LnN0YXRlID0gKCRfX3BsYWNlaG9sZGVyX18wKSA/ICRfX3BsYWNlaG9sZGVyX18xIDogJF9fcGxhY2Vob2xkZXJfXzI7XG4gICAgICAgIGJyZWFrIiwicmV0dXJuICRfX3BsYWNlaG9sZGVyX18wIiwiJGN0eC5tYXliZVRocm93KCkiLCJyZXR1cm4gJGN0eC5lbmQoKSIsIiRjdHgucHVzaFRyeShcbiAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18wLFxuICAgICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzEpOyIsIiRjdHguZmluYWxseUZhbGxUaHJvdWdoID0gJF9fcGxhY2Vob2xkZXJfXzAiLCIkY3R4LnBvcFRyeSgpOyIsIlxuICAgICAgICAgICAgICAgICAgICAgICRjdHguc3RhdGUgPSAkY3R4LmZpbmFsbHlGYWxsVGhyb3VnaDtcbiAgICAgICAgICAgICAgICAgICAgICBicmVhazsiLCJyZXR1cm4gJF9fcGxhY2Vob2xkZXJfXzAiXX0=
